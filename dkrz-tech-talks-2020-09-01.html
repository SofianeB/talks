<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Jupyter* @ DKRZ</title>

<meta name="description" content="">
<meta name="author" content="Sofiane Bendoukha">
<meta name="generator" content="reveal-ck 4.0.0">



<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">


<!-- Code syntax highlighting -->
<link rel="stylesheet" href="reveal.js/dist/reset.css">
<link rel="stylesheet" href="reveal.js/dist/reveal.css">
<link rel="stylesheet" href="reveal.js/dist/theme/serif.css" id="theme">

<!-- Theme used for syntax highlighting of code -->
<link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css">
    
<link rel="stylesheet" href="reveal-ck/files/reveal-ck/css/reveal-ck.css">

<!-- Printing and PDF exports -->
<script>
  var link = document.createElement( 'link' );
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.scss' : 'reveal.js/css/print/paper.scss';
  document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>

  </head>

  <body>
    <div class="reveal">
  <div class="slides">
    <section>

<h3><strong>Jupyter * @ DKRZ</strong></h3>
<h4>Interactive (Super) computing on Mistral</h4>

<table>
  <tbody>
    <tr>
      <td><img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse2.mm.bing.net%2Fth%3Fid%3DOIP.0M_91eDCRFzB_uknOBVKdAHaDn%26pid%3DApi&amp;f=1" style="border:none;" width="320"></td>
      <td><img src="https://jupyterhub.readthedocs.io/en/stable/_static/logo.png" alt="" width="470" style="border:none"></td>
    </tr>
  </tbody>
</table>

<p><strong>Dr. Sofiane Bendoukha</strong></p>

<p>Deutsches Klimarechenzentrum (DKRZ)</p>

<p><img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="http://creativecommons.org/licenses/by-sa/4.0/"></p>

<p style="font-size:14px"> * : hub/notebooks/lab/kernels </p>

</section>
<section>
<section>

<h3><strong>About me</strong></h3>
<p><br></p>
<ul>
  <li>
<strong>Background</strong>: Computer science</li>
  <li>
<strong>Department</strong>: Application Support</li>
  <li>
<strong>Currently:</strong>
    <ul>
      <li>backend developer –&gt; interactive computing</li>
      <li>containers</li>
    </ul>
  </li>
</ul>

</section>
<section>

<p><br><br></p>
<h1> Introduction </h1>

<pre><code data-trim data-noescape>&gt;&gt;&gt; import this
The Zen of Python, by Tim Peters

Beautiful is better than ugly.
Explicit is better than implicit.
Simple is better than complex.
Complex is better than complicated.


</code></pre>

</section>
<section>

<h3><strong>What is, Why Jupyter? (1)</strong></h3>

<p><em>Python is popular</em></p>

<p><img src="images/python_rank.png" alt="" width="900px" style="border:none"></p>

<p><small><a href="https://www.tiobe.com/tiobe-index/">https://www.tiobe.com/tiobe-index/</a></small></p>

<p><img src="images/history_python.png" alt="" width="900px" style="border:none"></p>

</section>
<section>

<h3><strong>What is, Why Jupyter? (2)</strong></h3>

<table>
  <tbody>
    <tr>
      <td><img src="https://jupyter.readthedocs.io/en/latest/_images/notebook_components.png" alt="" width="900px" style="border:none"></td>
      <td><img src="images/jupyterpreview.png" alt="" width="1290px" style="border:none"></td>
    </tr>
  </tbody>
</table>

<p><small><strong>web application</strong> that allows you to <strong>create</strong> and <strong>share</strong> documents that contain <strong>live code</strong>, equations, <strong>visualizations</strong>.</small></p>

</section>
<section>

<h3><strong>Jupyter Notebook on HPC</strong></h3>

<ul>
  <li>
    <p><strong>Local</strong>:<br>
Using Anaconda, anyone can install and run Jupyter Notebooks on their local computer.</p>
  </li>
  <li>
    <p><strong>HPC</strong>: Infrastructure-specific</p>
    <ul>
      <li>security concerns</li>
      <li>shared file systems</li>
      <li>metadata transactions</li>
    </ul>
  </li>
</ul>

<pre class="fragment"><code class="language-bash">1. SSH setup
2. Jupyter notebook setup
3. SSH to the remote system and start Jupyter notebook
4. Start Jupyter notebook with --no-browser and --port
5. Create an SSH "local port forward"
6. Open Jupyter notebook with your "Local" browser
</code></pre>


</section>
<section>

<h3><strong>What we provide @ DKRZ</strong></h3>
<p><br></p>
<ul>
  <li class="fragment">
<strong>Convenient way</strong>: <em>Jupyterhub</em>
    <ul>
      <li>user-friendly</li>
      <li>full user support</li>
      <li>continuous maintenance and update</li>
    </ul>
  </li>
  <li class="fragment">
<a href="https://www.dkrz.de/up/systems/mistral/programming/jupyter-notebook"><strong>Old school:</strong> <em>Single Jupyter notebooks</em></a> (ssh based)
    <ul>
      <li><code>./start_jupyter [Options]</code></li>
      <li>limited support (?)</li>
      <li>port forwarding can be annoying</li>
      <li>
<strong>Jupyterhub advanced spawner?</strong> <img class="emoji" alt=":thinking:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png">
</li>
    </ul>
  </li>
</ul>

</section>
<section>

<h3><strong>Roadmap</strong></h3>

<p><img src="images/roadmap.png" alt="" width="400%" style="border:none"></p>

</section>
<section>

<h3><strong>What’s new?</strong></h3>

<p><img src="images/whatsnew.png" alt="" style="border:none"></p>


</section>
<section>

<h3><strong>How it works?</strong></h3>

<table style="width:100%" class="center">

<tr>
<td>
<img src="https://github.com/jupyterhub/jupyterhub/blob/3663d7c8fcba2118dd469a8a4cca540cc63a39cf/docs/source/images/jhub-fluxogram.jpeg?raw=true" height="400" width="900" style="border:none">

    
</td>
<td>

<ul>
  <li><em>Manages authentication</em></li>
  <li><em>Spawns single-user notebook servers on-demand</em></li>
  <li><em>Gives each user a complete server</em></li>
</ul>
    
</td>
 
</tr>
</table>

</section>
<section>

<h3><strong>How it works on Mistral?</strong></h3>

<p><em>Spawning workflow</em></p>

<p><img src="images/spawning_mistral_new.png" width="1250px" style="border:none;" alt="Spawning workflow"></p>

</section>
<section>

<h3><strong>GUI</strong></h3>

<p><img src="images/gui.png" alt="" style="border:none;" height="520" width="920"></p>


</section>
<section>

<h3><strong>REST Web services</strong></h3>

<p><img src="images/services.png" style="border:none;" width="550"></p>

<table>
  <tbody>
    <tr>
      <td>Announcements (Admin) <img src="images/announcement.png" style="border:none;" width="570">
</td>
      <td>Accounts <img src="images/accounts.png" style="border:none;" width="500">
</td>
    </tr>
  </tbody>
</table>

</section>
<section>

<h3><strong>Documentation</strong></h3>

<p><img src="images/doc.png" alt="" width="870px" height="520px" style="float:center; border:none"></p>

<p><small>Any input/request is welcome!</small></p>

</section>
<section>

<h3><strong>JupyterLab (1)</strong></h3>

<p><img src="images/jlab.png" alt="" style="border:none"></p>


</section>
<section>

<h3><strong>JupyterLab (2)</strong></h3>

<p><em>switching between classic/lab</em></p>

<p><img src="images/lab-tree.gif" alt="" width="950px" height="450px" style="border:none"></p>


</section>
</section>

<section>
<section>

<h3><strong>Agenda</strong></h3>

<p><br></p>
<ul>
  <li><del>Introduction</del></li>
  <li>Spawning process</li>
  <li>Kernels</li>
  <li>Extensions</li>
  <li>Q &amp; A</li>
</ul>

</section>
</section>

<section>
<section>

<p><br><br><br></p>
<h1>Spawner options</h1>

</section>
<section>

<h3><strong>Overview</strong></h3>

<p><br><br>
<img src="images/spawning_overview.png" alt="" style="border:none"></p>


</section>
<section>

<h3><strong>Preset options form</strong></h3>

<p><br></p>

<table>
  <tbody>
    <tr>
      <td>Choose from the list <img src="images/preset.png" alt="" width="550px" style="border:none">
</td>
      <td>Available profiles <img src="images/profiles.png" alt="" width="400px" style="border:none">
</td>
    </tr>
  </tbody>
</table>


</section>
<section>

<h3><strong>Advanced options form (1)</strong></h3>

<p><img src="images/advanced_explained.png" alt="advanced" width="780" style="border:none"></p>



</section>
<section>

<h3><strong>Advanced options form (2)</strong></h3>

<p><img src="images/advanced_desc.png" alt="advanced" width="700" style="border:none"></p>


</section>
<section>

<h3><strong>Advanced options form (3)</strong></h3>

<table>
  <tbody>
    <tr>
      <td><img src="images/sbatch-error1.png" alt="advanced" style="border:none"></td>
      <td><img src="images/sbatch-error2.png" alt="advanced" style="border:none"></td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td><img src="images/cpu-error.png" alt="advanced" style="border:none"></td>
      <td><img src="images/min-error.png" alt="advanced" style="border:none"></td>
    </tr>
  </tbody>
</table>

<p class="fragment"><img src="images/mistral-conf.png" alt="" style="border:none"></p>


</section>
<section>

<h3><strong>Named servers</strong></h3>

<p><br></p>
<table style="width:100%" class="center">

<tr>
<td>
<img src="images/named_servers.gif" width="950px" style="border:none">
</td>
<td>
<ul>
  <li><em>Named servers allow you to have more than one server running in the same time</em></li>
  <li><em>Currently 2 allowed: <strong>preset</strong> and <strong>advanced</strong></em></li>
  <li><em>Extendable --&gt; HLRE 4 --&gt; more</em></li>
</ul>
 
</td>

</tr>
</table>


</section>
<section>

<h3><strong>Stop your server</strong></h3>

<p><img src="images/stop_server.gif" alt="" style="border:none" width="950px"></p>


</section>
</section>

<section>
<section>

<p><br></p>
<h1>Kernels</h1>

<p><img src="images/kernels.png" alt="" style="border:none"></p>

</section>
<section>

<h3><strong>What is happening in the background</strong></h3>

<p><img src="images/kernels_sequence.png" alt="" width="650px" height="520px" style="border:none"></p>


</section>
<section>

<h3><strong>Default system kernels</strong></h3>

<p><br></p>

<table>
  <thead>
    <tr>
      <th>Kernel</th>
      <th>Source module</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Python 2</td>
      <td>python/2.7.12</td>
    </tr>
    <tr>
      <td>Python 2</td>
      <td>anaconda2/bleeding_edge</td>
    </tr>
    <tr>
      <td>Python 3</td>
      <td>anaconda3/bleeding_edge</td>
    </tr>
    <tr>
      <td><span style="color:blue"><em>Python 3 unstable</em></span></td>
      <td><span style="color:blue"><em>python3/unstable</em></span></td>
    </tr>
  </tbody>
</table>

<p><span><small>"We will have a new Python about every half year, which is going to be called 'python3/YYYY.MM-compilerversion'. The first one is 'python3/2020.02-gcc-9.1.0'".</small></span></p>


</section>
<section>

<h3><strong>Bring your own environment (1)</strong></h3>

<ul>
  <li>Conda
    <pre><code>
% mkdir $HOME/kernels
% conda create --prefix $HOME/kernels/tensorflow ipykernel python=3.x
% source activate $HOME/kernels/tensorflow
% python -m ipykernel install --user --name tensorflow --display-name="tensorflow"
% conda deactivate 
</code></pre>
  </li>
  <li>Virtualenv
    <pre><code>% python -m pip install --user virtualenv
% python -m virtualenv --system-site-packages /path/to/new-kernel
% source /path/to/new-kernel/bin/activate
% pip install ipykernel
% python -m ipykernel install --user --name new-kernel --display-name="new-kernel"
</code></pre>
  </li>
</ul>

</section>
<section>

<h3><strong>Bring your own environment (2)</strong></h3>

<table style="width:100%" class="center">

<tr>
<td>
   Default
<pre><code data-trim="" data-noescape="">
{
  "argv": [
      "/path/to/kernel/bin/python",
      "-m",
      "ipykernel_launcher",
      "-f",
      "{connection_file}"
  ],
  "display_name": "new-kernel",
  "language": "python"
}
</code></pre>
    
</td>
<td>
   Customized
<pre><code data-trim="" data-noescape="">
{
    "argv": [
        "/path/to/kernel/bin/python",
        "-m",
        "ipykernel_launcher",
        "-f",
        "{connection_file}"
    ],
    "display_name": "new-kernel",
    "language": "python",
    "env": {
        "variable": "value",
    }
   }
</code></pre>   
</td>
 
</tr>
</table>

<p class="fragment fade-in"><em>more advanced</em>: use executable scripts! --&gt; <a href="https://jupyterhub.gitlab-pages.dkrz.de/jupyterhub-docs/kernels.html">check the doc</a></p>


</section>
<section>

<h3><strong>Using/Changing the kernels</strong></h3>

<p><img src="images/lab_kernels.png" alt="" width="1000px" style="border:none"></p>

</section>
<section>

<h3><strong>Using/Changing the kernels</strong></h3>

<p><img src="images/change_kernel_jupyter.png" alt="" width="730px" style="border:none"></p>

</section>
<section>

<h3><strong>Debugging</strong></h3>

<ul>
  <li class="fragment">preset spawner
    <ul>
      <li><strong>jupyterhub_slurmspawner_preset_{slurm_job_id}.log</strong></li>
    </ul>
  </li>
  <li class="fragment">advanced spawner
    <ul>
      <li>default: <strong>jupyterhub_slurmspawner_advanced_{slurm_job_id}.log</strong>
</li>
      <li>customized: <strong>you_name_it.log</strong>
</li>
    </ul>
  </li>
</ul>

<p><img class="fragment fade-in" src="images/help.png" width="400px" style="border:none"></p>


</section>
</section>

<section>
<section>

<p><br><br><br></p>

<h1>Extensions</h1>

</section>
<section>

<h3><strong>Jupyter extensions (1)</strong></h3>

<p><em>Nbextensions</em></p>

<p><img src="images/nbextensions.png" alt="" style="border:none"></p>


</section>
<section>

<h3><strong>Jupyter extensions (2)</strong></h3>

<p><em>Enabling/Disabling extensions</em></p>

<p><u><em>Enable:</em></u></p>

<pre><code>jupyter nbextension enable &lt;nbextension require path&gt;
</code></pre>

<p><u><em>Example:</em></u></p>

<pre><code>jupyter nbextension enable appmode/main
</code></pre>

<p><u><em>Disable:</em></u></p>

<pre><code>jupyter nbextension disable &lt;nbextension require path&gt;
</code></pre>


</section>
<section>

<h3><strong>Jupyter extensions (3)</strong></h3>

<p><em>Dask Labextension</em></p>

<p><img src="images/mask-ml.gif" alt="Dask Labextension" width="900px" height="430px" style="border:none"></p>


</section>
<section>

<h3><strong>Jupyter extensions (4)</strong></h3>

<p><em><a href="https://github.com/oschuett/appmode">https://github.com/oschuett/appmode</a></em></p>

<p><img src="https://github.com/oschuett/appmode/raw/master/screenshots.png" alt="" width="750px" style="border:none"></p>

<p><small>A Jupyter extensions that turns notebooks into web applications.</small></p>

</section>
<section>

<h3><strong>Jupyter extensions (5)</strong></h3>

<p><em>Do you need more?</em></p>

<table>
  <tbody>
    <tr>
      <td>Voila <img src="https://voila.readthedocs.io/en/stable/_images/voila-basics.gif" alt="" width="500px" style="border:none">
</td>
      <td>JupyterLab Git <img src="https://github.com/jupyterlab/jupyterlab-git/raw/master/docs/figs/demo-0-10-0.gif" alt="" width="400px" style="border:none">
</td>
      <td>TensorBoard<img src="https://github.com/chaoleili/jupyterlab_tensorboard/raw/master/image/tensorboard-overview.png" alt="" width="500px" style="border:none">
</td>
    </tr>
  </tbody>
</table>

<p>… support@dkrz.de</p>

<p><small><em>“The JupyterLab development team is excited to have a robust third-party extension community. However, we do not review third-party extensions, and some extensions may introduce security risks or contain malicious code that runs on your machine.”</em></small></p>

</section>
</section>

<section>
<section>

<h3><strong>Future work</strong></h3>

<ol>
  <li>Sharing services/extensions
    <ul>
      <li>shared notebooks repositories (Git/hub/lab)</li>
      <li>external sharing services</li>
      <li>WPS</li>
    </ul>
  </li>
  <li>Enhanced spawning queue for Jupyterhub</li>
  <li>More dedicated system kernels and extensions (e.g. ML)</li>
  <li>Speed up loading Python packages (HLR4)</li>
  <li>ContainerIze Jupyterhub</li>
  <li>Binder for Mistral?</li>
</ol>


</section>
<section>

<h3>Feedback? Questions?</h3>

<p><img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse2.mm.bing.net%2Fth%3Fid%3DOIP.0M_91eDCRFzB_uknOBVKdAHaDn%26pid%3DApi&amp;f=1" style="border:none;" width="360"></p>

<ul>
  <li><a href="https://jupyterhub.dkrz.de">Jupyterhub @ DKRZ</a></li>
  <li><a href="https://jupyterhub.gitlab-pages.dkrz.de/jupyterhub-docs/index.html">Technical documentation</a></li>
  <li>support@dkrz.de</li>
</ul>


</section>
</section>

  </div>
</div>

<script src="reveal.js/dist/reveal.js"></script>


<script>
  (function() {
  function extend( a, b ) {
    for(var i in b) {
      a[i] = b[i];
    }
  }
  var baseOptions = {
    transition: 'no',
    hash: true,
    dependencies: [
      { src: 'reveal-ck/files/reveal.js/plugin/markdown/marked.js' },
      { src: 'reveal.js/plugin/markdown/markdown.js' },
      { src: 'reveal.js/plugin/highlight/highlight.js' },
      { src: 'reveal.js/plugin/notes/notes.js', async: true }
    ]
  };


  var configOptions = {"width":1200,"margin":0.1,"minScale":0.2,"maxScale":1.5,"slideNumber":true,"showSlideNumber":"all","showNotes":false,"display":"block","center":false,"autoAnimate":true,"pdfSeparateFragments":true,"parallaxBackgroundImage":"images/Poster_quer_Hintergrund.jpg","parallaxBackgroundSize":"100% 100%","parallaxBackgroundHorizontal":0,"parallaxBackgroundVertical":0}
  var initializeOptions = {};
  extend(initializeOptions, baseOptions);
  extend(initializeOptions, configOptions);
  Reveal.initialize(initializeOptions);
})();

</script>

  </body>
</html>
